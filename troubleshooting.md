# MJPEGストリーミング遅延問題のトラブルシューティング

## 問題の概要
- **症状**: プロポON時に映像遅延が6〜8秒発生
- **原因**: TAMIYAプロポ(2.4GHz)とiPhoneテザリング(2.4GHz Wi-Fi)の電波干渉

## 検証結果
| 条件 | プロポ | ネットワーク | 遅延 |
|------|--------|--------------|------|
| ケース1 | OFF | iPhoneテザリング | 正常 ✓ |
| ケース2 | ON | iPhoneテザリング | 6-8秒遅延 ✗ |
| ケース3 | ON | Buffalo-A | 正常 ✓ |

## 解決策

### 【推奨】方法1: 5GHz帯Wi-Fiの使用
```bash
# iPhoneの設定で5GHz帯を優先的に使用
# 設定 > インターネット共有 > Wi-Fi帯域を「5GHz優先」に変更
# ※ iPhone 12以降で対応
```

**メリット**: 
- プロポ(2.4GHz)と完全に分離
- 高速・低遅延

**デメリット**:
- RasPi5のWi-Fiモジュールが5GHz対応か要確認
- 機種によっては非対応

### 方法2: チャンネル固定
iPhoneテザリングのチャンネルを固定し、プロポと離す:
- プロポが使用するチャンネルを確認
- iPhoneで別チャンネルに固定(設定変更が必要)

**課題**: iPhoneではチャンネル固定が困難

### 方法3: モバイルルーター導入
5GHz対応の小型モバイルルーターを使用:
```
RasPi5 <--5GHz Wi-Fi--> モバイルルーター <--4G/5G--> インターネット <--> MacBook
```

### 方法4: プロポを27MHz/40MHz帯に変更
2.4GHz帯以外のプロポシステムに交換:
- TAMIYA TEU-105BK(27MHz)など
- ただしレスポンスは2.4GHz帯より劣る

### 方法5: Buffalo-Aを携帯可能にする
- ポータブル電源でBuffalo-Aを稼働
- モバイル性は低下するが確実

## 技術的詳細

### 電波干渉のメカニズム
1. **パケット衝突**: 同一チャンネルで複数送信
2. **再送制御**: TCPレイヤーでの再送が遅延を増幅
3. **バッファリング**: 不安定な通信でバッファが蓄積

### RasPi5の5GHz対応確認
```bash
# RasPi5にSSHでログイン後
iwlist wlan0 channel | grep "5\."

# または
iw list | grep -A 10 "Frequencies:"
```

### ネットワーク遅延の測定
```bash
# MacBookから実行
ping -c 100 [RasPi5のIPアドレス]

# 統計情報で遅延を確認
```

## 次のアクション
1. RasPi5の5GHz対応確認
2. iPhone 5GHzテザリング設定(対応機種の場合)
3. 実走行テスト

## 参考情報
- 2.4GHz帯: 802.11b/g/n (チャンネル1-13)
- 5GHz帯: 802.11a/n/ac (チャンネル36-165)
- TAMIYA FHSS: 2.4GHz帯40チャンネルホッピング
